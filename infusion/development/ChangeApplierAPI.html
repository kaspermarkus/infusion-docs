<!DOCTYPE html>
<html lang="en">
    <head>
        <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <title>ChangeApplier API | Fluid Infusion</title>
        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/foundation.css">
        <link rel="stylesheet" href="css/highlightjs-custom.css">
        <link rel="stylesheet" href="css/octicons.css">
        <link rel="stylesheet" type="text/css" href="lib/infusion/src/framework/preferences/css/Enactors.css" />
        <link rel="stylesheet" type="text/css" href="lib/infusion/src/framework/preferences/css/PrefsEditor.css" />
        <link rel="stylesheet" type="text/css" href="lib/infusion/src/framework/preferences/css/SeparatedPanelPrefsEditor.css" />
        <link rel="stylesheet" href="css/infusion-docs.css">

        <link rel="icon" type="image/png" href="images/favico.png">

        <script type="text/javascript" src="lib/infusion/infusion-uio.js"></script>
        <script type="text/javascript" src="js/infusion-docs.js"></script>
        
    </head>
    <body class="infusion-docs fl-theme-prefsEditor-default">

        <div class="container infusion-docs-container">

            <!-- Skip Link -->
            <div id="skip">
                <a href="#tableOfContents">Jump to Table of Contents</a>
                <a href="#content">Skip to Content</a>
            </div>
            <!-- END skip link -->

            <!-- BEGIN markup for Preference Editor -->
            <div class="flc-prefsEditor-separatedPanel fl-prefsEditor-separatedPanel">
                <!-- This is the div that will contain the Preference Editor component -->
                <div class="flc-slidingPanel-panel flc-prefsEditor-iframe"></div>

                <!-- This div is for the sliding panel that shows and hides the Preference Editor controls -->
                <div class="fl-panelBar">
                    <span class="fl-prefsEditor-buttons">
                        <button id="reset" class="flc-prefsEditor-reset fl-prefsEditor-reset"><span class="fl-icon-undo"></span> Reset</button>
                        <button id="show-hide" class="flc-slidingPanel-toggleButton fl-prefsEditor-showHide">+ Show Display Preferences</button>
                    </span>
                </div>
            </div>

            <script type="text/javascript">
                fluid.uiOptions.prefsEditor(".flc-prefsEditor-separatedPanel", {
                    "templatePrefix": "lib/infusion/src/framework/preferences/html/",
                    "messagePrefix": "lib/infusion/src/framework/preferences/messages/",
                    "tocTemplate": "lib/infusion/src/components/tableOfContents/html/TableOfContents.html"
                });
            </script>

            <!-- END markup for Preference Editor -->

            <header class="row infusion-docs-header">
                <div class="infusion-docs-fluidLogo small-12 medium-3 column">
                    <a class="infusion-docs-fluidLogoText" href="index.html" title="Infusion">infusion</a>
                </div>

                <nav class="infusion-docs-fluidCategories small-12 medium-9 column">
                    
                    
                        
                            <a href="index.html" title="Infusion" class="infusion-docs-category-active">Infusion</a>
                        
                    
                        
                            <a href="index-tutorials.html" title="Tutorials">Tutorials</a>
                        
                    
                        
                            <a href="index-components.html" title="Components">Components</a>
                        
                    
                </nav>
            </header>

            <div class="infusion-docs-mainBody">
                <nav id="tableOfContents" class="infusion-docs-TOC small-12 medium-3 column" tabindex="-1">
                    
                        
                        
                            <span class="infusion-docs-category">Infusion</span>
                            
                                <span class="infusion-docs-sectionName">Writing Configuration</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="UnderstandingInfusionComponents.html"><span class="infusion-docs-TOC-pageName">Understanding Infusion Components</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ComponentOptionsAndDefaults.html"><span class="infusion-docs-TOC-pageName">Understanding Component Options And Defaults</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ComponentConfigurationOptions.html"><span class="infusion-docs-TOC-pageName">Component Configuration Options</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ComponentGrades.html"><span class="infusion-docs-TOC-pageName">Component Grades</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="FunctionGrades.html"><span class="infusion-docs-TOC-pageName">Function Grades</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="OptionsMerging.html"><span class="infusion-docs-TOC-pageName">Options Merging</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ComponentLifecycle.html"><span class="infusion-docs-TOC-pageName">Component Lifecycle</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="Priorities.html"><span class="infusion-docs-TOC-pageName">Priorities</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="FrameworkConcepts.html"><span class="infusion-docs-TOC-pageName">Framework Concepts</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">API</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="CoreAPI.html"><span class="infusion-docs-TOC-pageName">Core API</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="PromisesAPI.html"><span class="infusion-docs-TOC-pageName">Promises API</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="IoCAPI.html"><span class="infusion-docs-TOC-pageName">IoC API</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <span class="infusion-docs-TOC-pageName">ChangeApplier API</span>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ModelTransformationAPI.html"><span class="infusion-docs-TOC-pageName">Model Transformation API</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ViewAPI.html"><span class="infusion-docs-TOC-pageName">View API</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="DOMBinderAPI.html"><span class="infusion-docs-TOC-pageName">DOM Binder API</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="NodeAPI.html"><span class="infusion-docs-TOC-pageName">node.js Support and API</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Inversion of Control</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="HowToUseInfusionIoC.html"><span class="infusion-docs-TOC-pageName">How to Use Infusion IoC</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="SubcomponentDeclaration.html"><span class="infusion-docs-TOC-pageName">Subcomponent Declaration</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="Contexts.html"><span class="infusion-docs-TOC-pageName">Contexts</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ContextAwareness.html"><span class="infusion-docs-TOC-pageName">ContextAwareness</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="Invokers.html"><span class="infusion-docs-TOC-pageName">Invokers</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ExpansionOfComponentOptions.html"><span class="infusion-docs-TOC-pageName">Expansion of Component Options</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="IoCReferences.html"><span class="infusion-docs-TOC-pageName">IoC References</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="IoCSS.html"><span class="infusion-docs-TOC-pageName">IoCSS</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="DeclarativeThisismInIoC.html"><span class="infusion-docs-TOC-pageName">Declarative this-ism In IoC</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Events</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="InfusionEventSystem.html"><span class="infusion-docs-TOC-pageName">Infusion Event System</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="EventInjectionAndBoiling.html"><span class="infusion-docs-TOC-pageName">Event injection and boiling</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Models</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="ChangeApplier.html"><span class="infusion-docs-TOC-pageName">ChangeApplier</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <span class="infusion-docs-TOC-pageName">ChangeApplier API</span>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ModelRelay.html"><span class="infusion-docs-TOC-pageName">Model Relay</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Views</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="DOMBinder.html"><span class="infusion-docs-TOC-pageName">DOM Binder</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="DOMBinderAPI.html"><span class="infusion-docs-TOC-pageName">DOM Binder API</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ClassNameConventions.html"><span class="infusion-docs-TOC-pageName">Class Name Conventions</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Renderer</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="Renderer.html"><span class="infusion-docs-TOC-pageName">Renderer</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="HowToUseTheRenderer.html"><span class="infusion-docs-TOC-pageName">How to Use the Renderer</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="RendererComponentTrees.html"><span class="infusion-docs-TOC-pageName">Renderer Component Trees</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ProtoComponentTypes.html"><span class="infusion-docs-TOC-pageName">ProtoComponent Types</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="RendererComponentTreeExpanders.html"><span class="infusion-docs-TOC-pageName">Renderer Component Tree Expanders</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="Cutpoints.html"><span class="infusion-docs-TOC-pageName">Cutpoints</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="RendererComponents.html"><span class="infusion-docs-TOC-pageName">Renderer Components</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="RendererDecorators.html"><span class="infusion-docs-TOC-pageName">Renderer Decorators</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Preferences Framework</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="PreferencesFramework.html"><span class="infusion-docs-TOC-pageName">Preferences Framework</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="PreferencesEditor.html"><span class="infusion-docs-TOC-pageName">Preferences Editor</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="Builder.html"><span class="infusion-docs-TOC-pageName">Builder</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="PrimarySchemaForPreferencesFramework.html"><span class="infusion-docs-TOC-pageName">Primary Schema</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="AuxiliarySchemaForPreferencesFramework.html"><span class="infusion-docs-TOC-pageName">Auxiliary Schema</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ConnectingThePartsOfAPreferencesEditor.html"><span class="infusion-docs-TOC-pageName">Connecting the Parts of a Preferences Editor</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="Enactors.html"><span class="infusion-docs-TOC-pageName">Enactors</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="Panels.html"><span class="infusion-docs-TOC-pageName">Panels</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="CompositePanels.html"><span class="infusion-docs-TOC-pageName">Composite Panels</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ConditionalSubpanels.html"><span class="infusion-docs-TOC-pageName">Conditional Subpanels</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="LocalizationInThePreferencesFramework.html"><span class="infusion-docs-TOC-pageName">Localization in the Preferences Framework</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Testing</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="jqUnit.html"><span class="infusion-docs-TOC-pageName">Unit Testing with jqUnit</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="IoCTestingFramework.html"><span class="infusion-docs-TOC-pageName">IoC Testing Framework</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Migrating to Infusion 1.5</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="APIChangesFrom1_4To1_5.html"><span class="infusion-docs-TOC-pageName">API Changes from 1.4 to 1.5</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="DeprecationsIn1_5.html"><span class="infusion-docs-TOC-pageName">Deprecations In 1.5</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="tutorial-migratingToInfusion1.5/UIOptionsMigration.html"><span class="infusion-docs-TOC-pageName">UI Options Migration</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="tutorial-migratingToInfusion1.5/PagerMigration.html"><span class="infusion-docs-TOC-pageName">Pager Migration</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Migrating to Infusion 2.0</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="APIChangesFrom1_5To2_0.html"><span class="infusion-docs-TOC-pageName">API Changes from 1.5 to 2.0</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                        
                    
                        
                        
                    
                        
                        
                    
                </nav>

                <article id="content" class="infusion-docs-mainContent small-12 medium-9 column" tabindex="-1">
                    <div class="infusion-docs-articleContainer">

                        <div class="flc-toc-tocContainer infusion-docs-toc"> </div>
    
                        <h1>ChangeApplier API</h1>
    
                        <p class="infusion-docs-githubLink"><a href="https://github.com/fluid-project/infusion-docs/blob/master/src/documents/ChangeApplierAPI.md" target="_blank">Edit on GitHub</a></p>
    
                        
    
                        <div class="infusion-docs-articleBody">
                            <p>This section explains and documents the various Javascript API calls for instantiating and working with <a href="ChangeApplier.html">ChangeApplier</a>s. 
In practice, users will use the ChangeAppliers which are automatically constructed for every <a href="tutorial-gettingStartedWithInfusion/ModelComponents.html">Model Component</a> as its top-level member applier and will not construct their own. 
Furthermore, a good deal of the use made of ChangeAppliers will take the form of <a href="FrameworkConcepts.html#declarative-configuration">Declarative Configuration</a> rather than 
literal JavaScript API calls - many declarative uses were supported in Infusion 1.5 and even more will be supported in Infusion 2.0. This page presents both programmatic calls and their declarative equivalents where they exist.</p>
<h2 id="registering-interest-in-model-changes-using-a-changeapplier">Registering interest in model changes using a ChangeApplier</h2>
<h3 id="declarative-style-for-listening-to-changes">Declarative style for listening to changes</h3>
<p>The declarative style for registering interest in change events uses an entry in the <code>modelListeners</code> options area of a <code>modelComponent</code>. These listeners are attached to the applier during the construction process of the entire component (and its surrounding tree) and so will therefore become notified as part of the <a href="ModelRelay.html#the-initial-transaction">initial transaction</a> - they will therefore get to observe the model changing state from its primordial value of undefined to holding their initial resolved value. This is the <strong>recommended</strong> way of listening to model changes using the ChangeApplier system.</p>
<p>Each record in the modelListeners block has the format <code>&lt;modelPathReference&gt;: &lt;modelListener declaration&gt;</code>. The left and right hand sides of this definition will be explained in the subsequent sections:</p>
<h4 id="model-path-references">Model Path References</h4>
<p>A <code>&lt;modelPathReference&gt;</code> has the form:</p>
<table>
    <thead>
        <tr>
            <th colspan="3">Syntax definition for <code>&lt;modelPathReference&gt;</code> - the key in <code>modelListeners</code> options block for a <code>modelComponent</code></th>
        </tr>
        <tr>
            <th>Syntax</th>
            <th>Meaning</th>
            <th>Examples</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Simple String</td>
            <td>Reference to a model path in this component</td>
            <td>
                <ul>
                    <li><code>&quot;modelPath&quot;</code></li>
                    <li><code>&quot;modelPath.&#42;&quot;</code></li> <!-- the character * is destroyed by marked's gfm mode, but not by github markdown itself -->
                    <li><code>&quot;&quot;</code></li>
                    <li><code>&quot;&#42;&quot;</code></li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>IoC Reference</td>
            <td>Reference to a model path in another component</td>
            <td>
                <ul>
                    <li><code>&quot;{otherComponent}.model.modelPath&quot;</code></li>
                    <li><code>&quot;{otherComponent}.model.modelPath.&#42;&quot;</code></li>
                    <li><code>&quot;{otherComponent}.model&quot;</code></li>
                    <li><code>&quot;{otherComponent}.model.&#42;&quot;</code></li>
                </ul>
            </td>
        </tr>
    </tbody>
</table>

<p>The four examples presented in the <em>&quot;Examples&quot;</em> column are parallel for the two cases - they respectively match changes occurring in the same parts of the target model, only in the first row they match into the model attached to this component (the same one in which the <code>modelListeners</code> record appears) and in the second row they match into the model attached to another component - one referenced by the <a href="Contexts.html">Context Expression</a> <code>otherComponent</code>.</p>
<h4 id="model-listener-declaration">Model Listener Declaration</h4>
<p>A model listener declaration block has exactly the same form and meaning as any of the record types supported by <a href="Invokers.html">Invokers</a> and <a href="EventInjectionAndBoiling.html#listener-boiling">Listeners</a> -
including the one-string compact syntax documented with <a href="Invokers.html#compact-format">Invokers</a>, and the use of <a href="Priorities.html">Priorities</a>. There are two extra features that are supported in
model listener blocks that are not supported in standard listener declarations. These are the special context name <code>change</code>, and the ability to filter a change based on its <em>source</em>.</p>
<h4 id="the-special-context-change-">The special context <code>change</code></h4>
<p>An extra <a href="Contexts.html">context name</a> is available in a model listener block by the name of <code>change</code>. This is bound to the particular change event which triggered this listener. This context behaves as an object with the following fields:</p>
<table>
    <thead>
        <tr>
            <th colspan="3">Members of the <code>{change}</code> object bound in a model listener declaration</th>
        </tr>
        <tr>
            <th>Member</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>{change}.value</code></td>
            <td>Any type</td>
            <td>The new value which is now held at the model path matched by this model listener block</td>
        </tr>
        <tr>
            <td><code>{change}.oldValue</code></td>
            <td>Any type</td>
            <td>The previous value which was held at the matched model path, before it was overwritten by the change being listened to</td>
        </tr>
        <tr>
            <td><code>{change}.path</code></td>
            <td>String</td>
            <td>The path at which this change occurred. In general this will be the same as the path registered as the <code>modelPathReference</code> for this block - however it may be one segment longer if a wildcard path was used (see section on <a href="#wildcards-in-model-path-references">wildcards</a>)</td>
        </tr>
    </tbody>
</table>

<h4 id="source-tracking-and-filtering-in-model-listener-blocks">Source tracking and filtering in model listener blocks</h4>
<p>Each transaction holding one or more changes is associated with a particular <em>source</em>. Model listeners can use two special directives, <code>excludeSource</code> and <code>includeSource</code> in order to register their
interest or disinterest in receiving changes from particular sources. The default behaviour is to receive all changes from all sources. The values of these fields are single strings representing sources,
or arrays of these strings. The three currently supported sources are <code>init</code>, <code>relay</code> and <code>local</code> - custom user-defined sources may be supported in the future.</p>
<table>
    <thead>
        <tr>
            <th colspan="3">Fields of a model listener declaration operating source filtering</th>
        </tr>
        <tr>
            <th>Member</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>excludeSource</code></td>
            <td><code>String/Array of String</code></td>
            <td>A source or set of sources for which this listener should not receive notifications</td>
        </tr>
        <tr>
            <td><code>includeSource</code></td>
            <td><code>String/Array of String</code></td>
            <td>A source or set of sources for which this listener should receive notifications. If <code>excludeSource</code> is empty, <em>only</em> changes from these sources will be received. If <code>excludeSource</code> is not empty, these values will take priority.</td>
        </tr>
    </tbody>
</table>

<p>The values of sources supported as values in <code>excludeSource</code> and <code>includeSource</code> are as follows:</p>
<table>
    <thead>
        <tr>
            <th colspan="2">Values for sources supported as entries in <code>excludeSource</code> and <code>includeSource</code> as part of a model listener declaration</th>
        </tr>
        <tr>
            <th>Source</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>init</code></td>
            <td>The change arising from the <em>initial transaction</em>. During this change, the listener will observe the value of the model changing from <code>undefined</code> to its consistent initial value, during the
            overall process of component construction</td>
        </tr>
        <tr>
            <td><code>relay</code></td>
            <td>A change resulting from <a href="ModelRelay.html"><em>model relay</em></a> from another linked component in the model skeleton, elsewhere in the component tree.</td>
        </tr>
        <tr>
            <td><code>local</code></td>
            <td>A change directly triggered via the ChangeApplier on this component - either via a declarative record holding <code>changePath</code>, or programmatically using an <code>applier.change()</code> call</td>
        </tr>
    </tbody>
</table>

<p>Example featuring source filtering:</p>
<pre class="highlight"><code class="hljs javascript">fluid.defaults(<span class="hljs-string">"examples.sourceExample1"</span>, {
    gradeNames: [<span class="hljs-string">"fluid.modelComponent"</span>],
    model: {
        things: <span class="hljs-string">"initial value"</span>
    },
    modelListeners: {
        things: {
            funcName: <span class="hljs-string">"console.log"</span>,
            excludeSource: <span class="hljs-string">"init"</span>,
            args: <span class="hljs-string">"{change}.value"</span>
        }
    }
});

<span class="hljs-keyword">var</span> that = examples.sourceExample1();
that.applier.change(<span class="hljs-string">"things"</span>, <span class="hljs-string">"new value"</span>);
</code></pre>
<p>This example will not log the transition from the initial model state of <code>undefined</code> to the console. It will, however, log the value <code>new value</code> triggered via the ChangeApplier API.</p>
<p><strong>NOTE</strong>: The current implementation of the ChangeApplier has a bug (<a href="http://issues.fluidproject.org/browse/FLUID-5519">FLUID-5519</a>) which will often cause a model listener to be notified
before much of the surrounding component has constructed. This can be annoying, since the model listener may want to rely on other infrastructure (e.g. invokers, etc.) that it cannot
be sure have been constructed. For this reason, <code>excludeSource: &quot;init&quot;</code> is a useful way of stabilising this behaviour until the implementation is fixed (fix will be
delivered as part of <a href="http://issues.fluidproject.org/browse/FLUID-4925">FLUID-4925</a>).</p>
<h4 id="wildcards-in-model-path-references">Wildcards in model path references</h4>
<p>The last path segment of a model path reference may or may not be <code>&quot;*&quot;</code>. Whether it is <code>&quot;*&quot;</code> or not, the reference matches exactly the same set of changes - the only difference is in how they are reported. A path reference of <code>&quot;things&quot;</code> will match all changes occurring below this path segment, and report all those occurring within a single transaction as a single change. A path reference of <code>&quot;things.*&quot;</code> will match the same changes, but will report one change for each immediately nested path segment touched by the changes. For example, the following definition will log just one</p>
<pre class="highlight"><code class="hljs javascript">fluid.defaults(<span class="hljs-string">"examples.pathExample1"</span>, {
    gradeNames: [<span class="hljs-string">"fluid.modelComponent"</span>],
    modelListeners: {
        things: {
            funcName: <span class="hljs-string">"fluid.log"</span>,
            args: [<span class="hljs-string">"{change}.value"</span>, <span class="hljs-string">"{change}.path"</span>]
        }
    }
});

<span class="hljs-keyword">var</span> that = examples.pathExample1();
that.applier.change(<span class="hljs-string">"things"</span>, {a: <span class="hljs-number">1</span>, b: <span class="hljs-number">2</span>});
<span class="hljs-comment">// this logs {a: 1, b: 2}, "things" to the console</span>
</code></pre>
<p>However, the following example which just differs in the listener path (swapping <code>&quot;things&quot;</code> for <code>&quot;things.*&quot;</code>) will log two changes:</p>
<pre class="highlight"><code class="hljs javascript">fluid.defaults(<span class="hljs-string">"examples.pathExample2"</span>, {
    gradeNames: [<span class="hljs-string">"fluid.modelComponent"</span>],
    modelListeners: {
        <span class="hljs-string">"things.*"</span>: {
            funcName: <span class="hljs-string">"fluid.log"</span>,
            args: [<span class="hljs-string">"{change}.value"</span>, <span class="hljs-string">"{change}.path"</span>]
        }
    }
});

<span class="hljs-keyword">var</span> that = examples.pathExample2();
that.applier.change(<span class="hljs-string">"things"</span>, {a: <span class="hljs-number">1</span>, b: <span class="hljs-number">2</span>}); <span class="hljs-comment">// logs 2 lines</span>
<span class="hljs-comment">// Line 1: 1, "things.a"</span>
<span class="hljs-comment">// Line 2: 2, "things.b"</span>
</code></pre>
<p>The standard way to be notified of any changes to the model in a single notification is to use a model path reference consisting of the empty string <code>&quot;&quot;</code>. Use of <code>&quot;*&quot;</code> will react to the same changes, but will report multiple notifications for compound modifications as in the above example.</p>
<p>It is not currently possible to supply more than one wildcard segment per path reference, or to supply the wildcard at any position in the string other than as the last path segment.</p>
<h3 id="programmatic-style-for-listening-to-changes">Programmatic style for listening to changes</h3>
<p>The programmatic style for registering interest in model changes uses an API exposed by the ChangeApplier on its member <code>modelChanged</code> that is very similar to that exposed by a standard <a href="InfusionEventSystem.html">Infusion Event</a> - the difference is that the <code>addListener</code> method accepts an extra 1st argument, <code>pathSpec</code> - this holds the same model path reference documented in the previous section on declarative binding:</p>
<pre class="highlight"><code class="hljs javascript">applier.modelChanged.addListener(pathSpec, listener, namespace)
applier.modelChanged.removeListener(listener)
</code></pre>
<p><strong>NOTE</strong>: <em>This style of listening to changes is <strong>discouraged</strong>, but may be the right choice in some applications</em>. For example - the listener to be attached may not be available
at the time the component is constructed. Note that programmatically attached listeners will miss observation of the initial transaction as well as any other model changes that have occurred up to the point where they are registered.</p>
<p>The listener is notified after the change (or set of coordinated changes) has already been applied to the model - it is too late to affect this process and so this event is not <em>preventable</em>. The signature for these listeners is</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listener</span><span class="hljs-params">(value, oldValue, pathSegs, changeRequests)</span>
</span></code></pre>
<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>value</code></td>
            <td>The new (current) model value held at the path for which this listener registered interest</td>
        </tr>
        <tr>
            <td><code>oldValue</code></td>
            <td>A &quot;snapshot&quot; of the previous model value held at that path</td>
        </tr>
        <tr>
            <td><code>pathSegs</code></td>
            <td>An array of <code>String</code> path segments holding the path at which <code>value</code> and <code>oldValue</code> are/were held</td>
        </tr>
        <tr>
            <td><code>changeRequests</code></td>
            <td>A single <code>ChangeRequest</code> object or an array of them (see below) which were responsible for this change (may be empty)</td>
        </tr>
    </tbody>
</table>

<p>Users will in most cases only be interested in the first argument in this signature.</p>
<h2 id="triggering-a-change-using-a-changeapplier">Triggering a change using a ChangeApplier</h2>
<h3 id="declarative-style-for-triggering-a-change">Declarative style for triggering a change</h3>
<p>The declarative style for triggering model changes involve a kind of IoC record (a <em>change record</em>) that is supported in various places in component configuration, in particular as part of the definition of both <a href="Invokers.html">Invokers</a> and <a href="InfusionEventSystem.html">Listeners</a> of an IoC-configured component. 
This style of record is recognised by its use of the special member <code>changePath</code> which determines which path in which component model will receive the change.</p>
<table>
    <thead>
        <tr>
            <th colspan="3">Change record for firing changes by declarative binding</th>
        </tr>
        <tr>
            <th>Member</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>changePath</code></td>
            <td><code>&lt;modelPathReference&gt;</code> (String)</td>
            <td>
                The reference to the model path in a model somewhere in the component tree where the change is to be triggered. This has the same syntax as the model path references documented above for declarative listening, only wildcard forms are not supported. Four examples:
                <ul>
                    <li><code>&quot;modelPath&quot;</code></li>
                    <li><code>&quot;&quot;</code></li>
                    <li><code>&quot;{otherComponent}.model.modelPath&quot;</code></li>
                    <li><code>&quot;{otherComponent}.model&quot;</code></li>
                </ul>
            </td>
        </tr>
        <tr>
            <td><code>value</code></td>
            <td>Any type</td>
            <td>The value which should be stored at the path referenced by <code>changePath</code>. If this contains compound objects (built with <code>{}</code>), these will be merged into the existing values in the model. If this contains arrays (built with <code>[]</code>) these will overwrite existing values at that path.</td>
        </tr>
        <tr>
            <td><code>type</code></td>
            <td>String (optional)</td>
            <td>If this holds the value <code>DELETE</code>, this change will remove the value held at <code>changePath</code>. In this case, <code>value</code> should not be supplied. This is the recommended way of removing material from a model - it has the effect of the <code>delete</code> primitive of the JavaScript language. Sending changes holding a <code>value</code> of <code>null</code> or <code>undefined</code> does not have the same effect, as per the JavaScript language spec.</td>
        </tr>
    </tbody>
</table>

<h4 id="example-of-declarative-triggering-of-changes">Example of declarative triggering of changes</h4>
<p>In the below example, we construct an invoker that will set the entire model of the current component to whatever value is supplied as its first argument - this is achieved by giving its record a <code>changePath</code> of <code>&quot;&quot;</code> and binding its <code>value</code> to <code>{arguments}.0</code>:</p>
<pre class="highlight"><code class="hljs javascript">fluid.defaults(<span class="hljs-string">"examples.changeExample"</span>, {
    gradeNames: [<span class="hljs-string">"fluid.modelComponent"</span>],
    model: <span class="hljs-string">"initialValue"</span>,
    invokers: {
        changer: {
            changePath: <span class="hljs-string">""</span>,
            value: <span class="hljs-string">"{arguments}.0"</span>
        }
    }
});

<span class="hljs-keyword">var</span> that = examples.changeExample();
that.changer(<span class="hljs-string">"finalValue"</span>);
console.log(that.model); <span class="hljs-comment">// "finalValue"</span>
</code></pre>
<h3 id="programmatic-style-for-triggering-a-change">Programmatic style for triggering a change</h3>
<p>There are two calls which can be used to fire a change request - one informal, using immediate arguments, and a more formal method which constructs a concrete <code>changeRequest</code> object.</p>
<pre class="highlight"><code class="hljs javascript">applier.change(path, value, type)
</code></pre>
<table>
    <thead>
        <tr>
            <th>Path</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>path</code></td>
            <td><code>String</code></td>
            <td>An EL path into the model where the change is to occur.</td>
        </tr>
        <tr>
            <td><code>value</code></td>
            <td>Any type</td>
            <td>An object which is to be added into the model</td>
        </tr>
        <tr>
            <td><code>type</code></td>
            <td>(optional) <code>&quot;ADD&quot;</code> or <code>&quot;DELETE&quot;</code></td>
            <td>A key string indicating whether this is an <code>ADD</code> request (the default) or a <code>DELETE</code> request (a request to unlink a part of the model)</td>
        </tr>
    </tbody>
</table>

<p>The semantics and values are exactly the same as described in the section on declarative triggering above - with the difference that IoC references may not be supplied for <code>path</code>.</p>
<pre class="highlight"><code class="hljs javascript">applier.fireChangeRequest(changeRequest)
</code></pre>
<p>where a <strong>changeRequest</strong> is an object holding the above named parameters in named fields - e.g. <code>{path: &quot;modelPath&quot;, value: &quot;newValue&quot;}</code> <code>change</code> and <code>fireChangeRequest</code> reach exactly the same implementation - the only difference is in the packaging of the arguments. For <code>change</code> they are spread out as a sequence of 3 arguments, whereas for <code>fireChangeRequest</code>, they are packaged up as named fields (<code>path</code>, <code>value</code> and <code>type</code>) of a plain JavaScript object. Such an object is called a <strong>&quot;ChangeRequest&quot;</strong> and is a convenient package for these requests to pass around in in an event pipeline within the framework.</p>
<p>The programmatic style for <strong>firing</strong> changes is less strongly discouraged than the programmatic style for <strong>listening</strong> to changes is - since it does not run into the same lifecycle issues that programmatic listeners do. However, the declarative style for triggering changes should be used wherever it can.</p>
<h3 id="example-of-two-styles-of-declarative-model-listener-registration">Example of two styles of declarative model listener registration</h3>
<p>Users can freely define very fine or coarse-grained listeners for changes in a model using the ChangeApplier. Here are some examples using the new declarative model listener registration syntax in Infusion 1.5:</p>
<pre class="highlight"><code class="hljs javascript">fluid.defaults(<span class="hljs-string">"my.component"</span>, {
    gradeNames: [<span class="hljs-string">"fluid.modelComponent"</span>, <span class="hljs-string">"fluid.component"</span>],

    invokers: {
        printChange: {
            <span class="hljs-string">"this"</span>: <span class="hljs-string">"console"</span>,
            method: <span class="hljs-string">"log"</span>,
            args: [<span class="hljs-string">"{arguments}.0"</span>]
        }
    },

    model: {
        cats: {
            hugo: {
                name: <span class="hljs-string">"Hugo"</span>,
                colours: [<span class="hljs-string">"white"</span>, <span class="hljs-string">"brown spots"</span>]
            },
            clovis: {
                name: <span class="hljs-string">"THE CATTT!"</span>,
                colours: [<span class="hljs-string">"white"</span>, <span class="hljs-string">"black spots"</span>, <span class="hljs-string">"black moustache"</span>]
            }
        }
    },

    modelListeners: {
        <span class="hljs-comment">// Will fire individual change events whenever any part of "cats.hugo" changes.</span>
        <span class="hljs-comment">// {change}.value will correspond to each changed path within "hugo".</span>
        <span class="hljs-string">"cats.hugo.*"</span> {
            funcName: <span class="hljs-string">"{that}.printChange"</span>,
            args: [{change}.value]
        },

        <span class="hljs-comment">// Will fire a single composite change event whenever any part of "cats.clovis" changes.</span>
        <span class="hljs-comment">// {change}.value will contain the new state of the "clovis" object.</span>
        <span class="hljs-string">"cats.clovis"</span>: {
            funcName: <span class="hljs-string">"{that}.printChange"</span>,
            args: [{change}.value]
        }
    }
});

<span class="hljs-comment">// Example usage.</span>
<span class="hljs-keyword">var</span> c = my.component();
c.applier.change(<span class="hljs-string">"cats.hugo"</span>, {
    name: <span class="hljs-string">"Hugonaut"</span>,
    colours: [<span class="hljs-string">"hard to tell"</span>]
});
&gt; <span class="hljs-string">"Hugonaut"</span>
&gt; [<span class="hljs-string">"hard to tell"</span>]

c.applier.change(<span class="hljs-string">"cats.clovis.name"</span>, <span class="hljs-string">"THER CATTT!"</span>);
&gt; {name: <span class="hljs-string">"THER CATTT!"</span>, colours: [<span class="hljs-string">"white"</span>, <span class="hljs-string">"black spots"</span>, <span class="hljs-string">"black moustache"</span>]}
</code></pre>
<h2 id="low-level-changeapplier-apis">Low-level ChangeApplier APIs</h2>
<p>These are not recommended for typical users of the framework, and are not stable.</p>
<h3 id="instantiating-a-changeapplier">Instantiating a ChangeApplier</h3>
<p>Instantiating a ChangeApplier manually is not recommended in current versions of the framework. Its implementation is tightly bound into its location in 
an IoC component tree and should be constructed by the IoC system itself.</p>
<h3 id="operating-transactions-manually">Operating transactions manually</h3>
<p>A user may be interested in economising on notifications to model updates; by batching these up into a single transaction, there will
just be a single notification of each listener which is impacted around the model skeleton. This facility is unstable and will be 
rewritten prior to the final Infusion 2.0 release.</p>
<p>A transaction can be opened using the <code>initiate()</code> method of the applier function which returns a transaction object:</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-keyword">var</span> myApplier = myModelComponent.applier;
<span class="hljs-keyword">var</span> myTransaction = myApplier.initiate();
</code></pre>
<p>The transaction object exposes an API which agrees with the ChangeApplier&#39;s own API for triggering changes, which can be used to trigger changes within the transaction:</p>
<pre class="highlight"><code class="hljs javascript">myTransaction.fireChangeRequest(requestSpec1);
myTransaction.fireChangeRequest(requestSpec2);
...
</code></pre>
<p>The transaction can be completed using the <code>commit()</code> function of the transaction object:</p>
<pre class="highlight"><code class="hljs javascript">myTransaction.commit();
</code></pre>
<p>A single <code>modelChanged</code> event will be fired on completion of the commit, regardless of the number of change requests.</p>

                        </div>
                    </div>

                    <footer class="row infusion-docs-footer">
                        <p class="infusion-docs-footerInfusion">Infusion is created by the <a href="http://fluidproject.org/" target="_blank">Fluid Project</a>,<br/>
                        a project of the <a href="http://idrc.ocad.ca/" target="_blank">Inclusive Design Research Centre</a> at <a href="http://www.ocadu.ca/" target="_blank">OCAD University</a>, funded by a grant from <a href="http://www.mellon.org/" target="_blank">The Andrew W. Mellon Foundation</a>.</p>
                    </footer>

                </article>
                
            </div>


        </div> <!-- end container -->
        <script>
            fluid.docs.onLoad();
        </script>

    </body>
    
</html>
